---
import Layout from "../../layouts/Layout.astro"
import { RouteGuard } from "../../components/routeguard"
import { getFlightById } from "../../../lib/actions/flights/actions"
import { getAirships } from "../../../lib/actions/airships/actions"
import { StepperStructure } from "../../components/stepper/StepperStructure"
import { getClients } from "../../../lib/actions/clients/actions"
import type { Airship } from "../../components/table/TableModal"

const { trip } = Astro.params
if (!trip) return Astro.redirect("/404")
const flight = await getFlightById(parseInt(trip))
const clients = await getClients()
const airships = await getAirships()
const chosenAirship = airships.find(
	(airship: Airship) => airship.title === flight.airship_name
)
---

<Layout title="trip">
	<RouteGuard client:load="react">
		<StepperStructure
			currentFlight={flight}
			listAirships={airships}
			listClients={clients}
			chosenAirship={chosenAirship}
			client:load
		/>
	</RouteGuard>
</Layout>
