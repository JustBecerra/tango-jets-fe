import{j as e}from"./jsx-runtime.CDeAccHH.js";import{r}from"./index.CqbGxsOR.js";import{T as h,H as N,M as E,F as k,S as _,f as C}from"./FlightInfo.7ivDg8rd.js";import{u as p,a as I,g as O}from"./actions.DqSaCuXh.js";import{g as H}from"./getCookie.CtV4NB4x.js";import{L}from"./LoaderSpinner.t290QIza.js";import"./index.D2MAbzvX.js";import"./index.Cb2GqDXq.js";async function M(s){try{const t=await fetch("https://vuelos-be.onrender.com/email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const o=await t.text();return o?JSON.parse(o):{}}catch(t){throw console.error("Error adding flight:",t),t}}const G=()=>{const[s,t]=r.useState("first"),[o,i]=r.useState(!1),f=p(a=>a.airships),[c,u]=r.useState({launchtime:new Date,to:"",from:"",master_passenger:""}),[m,g]=r.useState([{airship_name:"",price_cost:0,price_revenue:0}]),[x,d]=r.useState(!1),{updateFlights:w}=p(a=>a),S=async a=>{a.preventDefault(),d(!0);const{launchtime:j,to:y,from:v,master_passenger:T}=c,b=H("username"),n={launchtime:j.toISOString().slice(0,16),to:y,from:v,master_passenger:T,createdby:b};try{const l=await I(n),F={to:n.master_passenger,subject:"Flight pre-scheduled!",text:C({transformedFlightData:n,airshipData:m,airships:f,tripID:l.id})};await M(F);const D=await O();w(D),i(!0),setTimeout(()=>{i(!1),window.location.href="/Trips"},2e3)}catch(l){console.error("Error adding flight:",l)}finally{d(!1)}};return e.jsxs("div",{className:"relative overflow-x-auto overflow-y-auto max-h-[800px] bg-gray-700 w-full max-w-[100%] shadow-md sm:rounded-lg px-6",children:[o&&e.jsx("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2",children:e.jsxs(h,{children:[e.jsx("div",{className:"inline-flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-green-100 text-green-500",children:e.jsx(N,{className:"h-5 w-5"})}),e.jsx("div",{className:"ml-3 text-sm font-normal",children:"Flight added successfully."}),e.jsx(h.Toggle,{onClick:()=>i(!1)})]})}),e.jsx(E,{phase:s}),e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("form",{onSubmit:S,children:[e.jsx(k,{phase:s,formData:c,setFormData:u,airshipData:m,setAirshipData:g}),e.jsx(_,{phase:s,setPhase:t,operation:"add"})]})}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx(L,{})})]})};export{G as default};
